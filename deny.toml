# cargo-deny configuration
# https://embarkstudios.github.io/cargo-deny/

[graph]
targets = [
    "x86_64-unknown-linux-gnu",
    "x86_64-pc-windows-msvc",
    "x86_64-apple-darwin",
    "aarch64-apple-darwin",
]

# =============================================================================
# Advisories - Security vulnerability and unmaintained crate checks
# =============================================================================
[advisories]
db-path = "~/.cargo/advisory-db"
db-urls = ["https://github.com/rustsec/advisory-db"]

# Unmaintained crates: only error on workspace crates, warn on transitive
unmaintained = "workspace"

# Documented advisory ignores with rationale
ignore = [
    # -------------------------------------------------------------------------
    # azure_core 0.21 transitive dependencies
    # Updating to azure_core 0.30+ requires code changes (breaking API changes)
    # in src/database/auth.rs. Tracked for future release.
    # -------------------------------------------------------------------------
    { id = "RUSTSEC-2024-0384", reason = """
        `instant` is unmaintained but has no security vulnerabilities.
        Transitive dependency of azure_core 0.21 via http-types -> futures-lite -> fastrand.
        Fix requires updating to azure_core 0.30+ which has breaking API changes.
        Impact: None - timing utility, not security-sensitive.
    """ },

    { id = "RUSTSEC-2024-0436", reason = """
        `paste` is unmaintained but has no security vulnerabilities.
        Transitive dependency of azure_core 0.21.
        Fix requires updating to azure_core 0.30+ which has breaking API changes.
        Impact: None - proc-macro crate with no runtime code.
    """ },

    # -------------------------------------------------------------------------
    # tiberius 0.12.3 transitive dependency (SQL Server driver)
    # tiberius 0.12.3 is the latest version - no upstream fix available.
    # Also appears in dev dependencies via bollard/testcontainers.
    # -------------------------------------------------------------------------
    { id = "RUSTSEC-2025-0134", reason = """
        `rustls-pemfile` 1.x/2.x is unmaintained (project ended).
        - 1.x: Transitive dependency of tiberius 0.12.3 (prod) for TLS cert loading
        - 2.x: Transitive dependency of bollard (dev-only via testcontainers)
        tiberius 0.12.3 is the latest version - no upstream fix available.
        Impact: Low - no known security vulnerabilities, just unmaintained.
    """ },
]

# =============================================================================
# Licenses - Only list licenses actually used by dependencies
# =============================================================================
[licenses]
allow = [
    "Apache-2.0",
    "BSD-3-Clause",
    "ISC",
    "MIT",
    "Unicode-3.0",
]
confidence-threshold = 0.8

# =============================================================================
# Bans - Prevent specific crates or duplicate versions
# =============================================================================
[bans]
# Duplicate crate versions - warn but don't fail
# Current duplicates caused by tiberius 0.12.3 using older dependencies:
# - base64: 0.21 (tiberius) vs 0.22 (rmcp, bollard)
# - thiserror: 1.x (tiberius) vs 2.x (this crate, rmcp)
# - getrandom: 0.2 (ring via rustls) vs 0.3 (uuid)
# - windows-sys: version differences in transitive deps
# These cannot be resolved without tiberius updating upstream.
multiple-versions = "warn"
wildcards = "warn"
highlight = "all"
deny = []
allow = []
skip = []

# =============================================================================
# Sources - Restrict where crates can be fetched from
# =============================================================================
[sources]
unknown-registry = "deny"
unknown-git = "deny"
allow-registry = ["https://github.com/rust-lang/crates.io-index"]
allow-git = []
