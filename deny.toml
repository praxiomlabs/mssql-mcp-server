# cargo-deny configuration
# https://embarkstudios.github.io/cargo-deny/

[graph]
# Targets to check
targets = [
    "x86_64-unknown-linux-gnu",
    "x86_64-pc-windows-msvc",
    "x86_64-apple-darwin",
    "aarch64-apple-darwin",
]

# =============================================================================
# Advisories - Security vulnerability and unmaintained crate checks
# =============================================================================
[advisories]
db-path = "~/.cargo/advisory-db"
db-urls = ["https://github.com/rustsec/advisory-db"]

# How to handle unmaintained crates
# "workspace" = only error on workspace crates, warn on transitive
unmaintained = "workspace"

# Ignore specific advisories with documented rationale
ignore = [
    # Dev-only: tokio-tar via testcontainers (no fix available upstream)
    "RUSTSEC-2025-0111",
]

# =============================================================================
# Licenses - Ensure all dependencies use acceptable licenses
# =============================================================================
[licenses]
# Only list licenses actually used by dependencies
allow = [
    "Apache-2.0",
    "BSD-3-Clause",
    "ISC",
    "MIT",
    "Unicode-3.0",
]
confidence-threshold = 0.8

# =============================================================================
# Bans - Prevent specific crates or duplicate versions
# =============================================================================
[bans]
# Duplicates are unavoidable in the Rust ecosystem - don't warn
multiple-versions = "allow"
wildcards = "warn"
highlight = "all"
deny = []
allow = []
skip = []

# =============================================================================
# Sources - Restrict where crates can be fetched from
# =============================================================================
[sources]
unknown-registry = "deny"
unknown-git = "deny"
allow-registry = ["https://github.com/rust-lang/crates.io-index"]
allow-git = []
